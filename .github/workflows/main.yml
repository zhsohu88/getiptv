name: Run getiptv script  # å·¥ä½œæµç¨‹åç§°

on:
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘
  schedule:            # å®šæ—¶è§¦å‘ï¼ˆæ¯å¤©åŒ—äº¬æ—¶é—´ 07:00ï¼‰
    - cron: '0 23 * * *'  # GitHub ä½¿ç”¨ UTC æ—¶é—´ï¼Œ23:00 UTC = åŒ—äº¬æ—¶é—´ 07:00

permissions:
  contents: write  # å…è®¸å·¥ä½œæµç¨‹æ¨é€ä»£ç åˆ°ä»“åº“ï¼ˆæƒé™ï¼‰

jobs:
  run-script:  # å®šä¹‰ä¸€ä¸ªåä¸º run-script çš„ä»»åŠ¡
    runs-on: ubuntu-latest  # ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Ubuntu è™šæ‹Ÿç¯å¢ƒ

    steps:
      - name: ğŸ“¥ Checkout repository  # ç¬¬ä¸€æ­¥ï¼šæ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v3

      - name: ğŸ Set up Python  # ç¬¬äºŒæ­¥ï¼šè®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"  # ä½¿ç”¨ Python 3.10

      - name: ğŸ“¦ Install dependencies  # ç¬¬ä¸‰æ­¥ï¼šå®‰è£…ä¾èµ–åº“
        run: |
          pip install requests chardet  # å®‰è£… requests å’Œ chardet åº“

      - name: â–¶ï¸ Run getiptv.py  # ç¬¬å››æ­¥ï¼šè¿è¡Œ Python è„šæœ¬
        run: python getiptv.py

      - name: ğŸ“ Commit output file (if needed)  # ç¬¬äº”æ­¥ï¼šå¦‚æœç”Ÿæˆäº† user_local.txtï¼Œå°±æäº¤åˆ°ä»“åº“
        run: |
          if [ -f "user_local.txt" ]; then
            git config user.name "github-actions[bot]"  # è®¾ç½®æäº¤ç”¨æˆ·å
            git config user.email "github-actions[bot]@users.noreply.github.com"  # è®¾ç½®æäº¤é‚®ç®±
            git add user_local.txt  # æ·»åŠ æ–‡ä»¶åˆ° Git æš‚å­˜åŒº
            git commit -m "Update user_local.txt from getiptv.py"  # æäº¤æ›´æ”¹
            git push  # æ¨é€åˆ°è¿œç¨‹ä»“åº“
          fi
